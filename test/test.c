#include "../src/json_value.h"
#include "../src/json_string.h"
#include "../src/json_stringifier.h"

#include <stdio.h>
#include <float.h>
#include <stdlib.h>
#include <assert.h>

int main() {
    uint32_t i, n = 16;
    json_value* value = json_value_alloc();
    value->type = JSON_VALUE_ARRAY;
    value->json_array = json_array_alloc();
    json_value* item;

    for(i = 0; i < n; i++) {
        item = json_string_alloc("Value");
        json_values_list_add(value->json_array->items, item);

        item = json_value_alloc();
        item->type = JSON_VALUE_NUMBER;
        item->json_number = 4294967295.000000;
        json_values_list_add(value->json_array->items, item);

        item = json_value_alloc();
        item->type = JSON_VALUE_NUMBER;
        item->json_number = 179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.0000;
        json_values_list_add(value->json_array->items, item);

        item = json_value_alloc();
        item->type = JSON_VALUE_NUMBER;
        item->json_number = -2147483647.000000;
        json_values_list_add(value->json_array->items, item);
    }

    json_stringifier* stringifier = json_stringifier_alloc();
    json_stringifier_stringify(stringifier, value);

    const char* expected = "[\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000,\"Value\",4294967295.000000,179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000,-2147483647.000000]";
    size_t offset = 0;
    assert(json_characters_list_length(stringifier->characters_list) == 161);
    vector_foreach(stringifier->characters_list, j) {
        char* string = vector_get(stringifier->characters_list, j);
        uint32_t length = strlen(string);
        assert(strncmp(&expected[offset], string, length) == 0);
        offset += length;
    }

    json_value_free(value);
    json_stringifier_free(stringifier);

    return 0;
}